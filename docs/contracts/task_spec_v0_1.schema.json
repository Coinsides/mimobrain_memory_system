{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mimobrain.local/schemas/task_spec_v0_1.json",
  "title": "TaskSpec v0.1",
  "type": "object",
  "additionalProperties": false,
  "required": ["task_id", "type", "created_at", "idempotency_key", "inputs", "params"],
  "properties": {
    "task_id": {
      "type": "string",
      "description": "Unique task id (ULID/UUID/string)."
    },
    "type": {
      "type": "string",
      "description": "Task type enum (keep minimal early, expand later).",
      "enum": [
        "INGEST_RAW",
        "PACK_MU",
        "VALIDATE_MU",
        "INDEX_MU",
        "GRAPH_UPSERT",
        "BUILD_VIEW",
        "BUILD_BUNDLE",
        "REPAIR_POINTER",
        "RUN_GOLDEN"
      ]
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "parent_task_id": {
      "type": ["string", "null"]
    },
    "idempotency_key": {
      "type": "string",
      "description": "Stable key for dedup/replay (e.g., sha256(template+scope+granularity))."
    },
    "inputs": {
      "type": "array",
      "minItems": 0,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["kind", "ids"],
        "properties": {
          "kind": {
            "type": "string",
            "enum": ["MU_SET", "RAW_SET", "ASSET_SET", "VIEW", "BUNDLE", "TEXT"]
          },
          "ids": {
            "type": "array",
            "items": {"type": "string"}
          }
        }
      }
    },
    "params": {
      "type": "object",
      "description": "Task parameters (template/scope/granularity etc).",
      "additionalProperties": true
    },
    "budget": {
      "type": "object",
      "additionalProperties": false,
      "required": [],
      "properties": {
        "max_tokens": {"type": "integer", "minimum": 0},
        "timeout_sec": {"type": "integer", "minimum": 0},
        "max_mu": {"type": "integer", "minimum": 0}
      }
    },
    "constraints": {
      "type": "object",
      "additionalProperties": true
    }
  }
}
